// Code omitted for brevity (see canvas document)